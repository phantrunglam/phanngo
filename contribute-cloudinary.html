<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đóng Góp Thông Tin Gia Phả</title>
  <!-- Cloudinary Widget JS -->
  <script src="https://upload-widget.cloudinary.com/global/all.js"></script>
  <style>
    /* CSS cho form (giữ nguyên từ code trước) */
    .hidden { display: none; }
    #preview { margin-top: 10px; }
    #preview img { max-width: 200px; }
  </style>
</head>
<body>
  <form name="contribute" netlify action="/thank-you.html">
    <!-- Các trường thông tin cũ -->
    <label>Họ tên: <input type="text" name="name" required></label>
    <label>Email: <input type="email" name="email" required></label>
    <label>Nội dung: <textarea name="message" required></textarea></label>

    <!-- Phần upload ảnh mới -->
    <label>Ảnh đính kèm:</label>
    <button type="button" id="upload-button">Chọn ảnh</button>
    <div id="preview"></div>
    <input type="hidden" name="photo-url" id="photo-url">

    <!-- Nút gửi form -->
    <button type="submit">Gửi đóng góp</button>
  </form>

  <script>
    // Cấu hình Cloudinary Widget
    const widget = cloudinary.createUploadWidget({
      cloudName: 'dmzxll8xc',  // Thay bằng cloud_name của bạn
      uploadPreset: 'glk_upload', // Thay bằng upload preset
      sources: ['local', 'camera'],
      multiple: false,
      clientAllowedFormats: ['jpg', 'png', 'webp'],
      maxFileSize: 5000000 // Giới hạn 5MB
    }, (error, result) => {
      if (result.event === 'success') {
        // Hiển thị ảnh preview
        document.getElementById('preview').innerHTML = `
          <img src="${result.info.secure_url}" alt="Ảnh đã tải lên">
          <p>Ảnh đã sẵn sàng!</p>
        `;
        // Lưu URL ảnh vào hidden input
        document.getElementById('photo-url').value = result.info.secure_url;
      }
    });

    // Mở widget khi click nút
    document.getElementById('upload-button').addEventListener('click', () => {
      widget.open();
    });
  </script>
</body>
</html>