<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒê√≥ng G√≥p Th√¥ng Tin Gia Ph·∫£</title>
  <!-- Cloudinary Widget JS -->
  <script src="https://upload-widget.cloudinary.com/global/all.js"></script>

<style>
  .hidden { display: none; }
    #preview { margin-top: 10px; }
    #preview img { max-width: 200px; }
    .error-message { color: red; margin-top: 5px; }
    .success-message { color: green; margin-top: 5px; }
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    line-height: 1.6;
  }
  .form-group {
    margin-bottom: 15px;
  }
  label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }
  input[type="text"],
  input[type="email"],
  textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  textarea {
    min-height: 100px;
  }
  button {
    background: #4CAF50;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover {
    background: #45a049;
  }
  .hidden {
    display: none;
  }
  .error {
    color: red;
    font-size: 0.9em;
  }
  .contribute-button {
  display: inline-block;
  padding: 12px 24px;
  background-color: #4CAF50;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  font-weight: bold;
  transition: background-color 0.3s;
}

.contribute-button:hover {
  background-color: #45a049;
}
.info-message {
  color: #0066cc;
  margin-top: 5px;
}
</style>

</head>
<body>
  <form name="contribute" netlify action="/thank-you.html" netlify-honeypot="bot-field">
    <!-- Tr∆∞·ªùng ch·ªëng spam -->
    <p class="hidden">
      <label>Kh√¥ng ƒëi·ªÅn v√†o ƒë√¢y: <input name="bot-field"></label>
    </p>
    
    <!-- C√°c tr∆∞·ªùng th√¥ng tin -->
    <label>H·ªç t√™n: <input type="text" name="name" required></label>
    <label>Email: <input type="email" name="email" required></label>
    <label>N·ªôi dung: <textarea name="message" required></textarea></label>

    <!-- Ph·∫ßn upload ·∫£nh -->
    <label>·∫¢nh ƒë√≠nh k√®m:</label>
    <button type="button" id="upload-button">Ch·ªçn ·∫£nh</button>
    <div id="preview"></div>
    <div id="upload-status" class="error-message"></div>
    
    <!-- Hidden fields ƒë·ªÉ l∆∞u URL ·∫£nh v√† hi·ªÉn th·ªã trong email -->
    <input type="hidden" name="photo-url" id="photo-url">
    <input type="hidden" name="photo-html" id="photo-html">

    <button type="submit">G·ª≠i ƒë√≥ng g√≥p</button>
  </form>

  <script>
    // C·∫•u h√¨nh Cloudinary Upload Widget
    const widget = cloudinary.createUploadWidget({
      cloudName: 'dmzxll8xc',
      uploadPreset: 'glk_upload', // ƒê√£ c·∫•u h√¨nh l√† Unsigned
      sources: ['local', 'camera'],
      tags: ['contribute'], // üëà Th√™m tags c·ªë ƒë·ªãnh cho vi·ªác ng∆∞·ªùi d√πng g·ª≠i ·∫£nh l√™n
      context: { alt: 'User uploaded image' }, // Metadata t√πy ch·ªçn
      multiple: false,
      clientAllowedFormats: ['jpg', 'png', 'webp'],
      maxFileSize: 5000000, // 5MB
      cropping: false,
      showAdvancedOptions: false,
      styles: {
        palette: {
          window: "#FFFFFF",
          sourceBg: "#F4F4F5",
          windowBorder: "#90A0B3",
          tabIcon: "#000000",
          inactiveTabIcon: "#555A5F",
          menuIcons: "#555A5F",
          link: "#0433FF",
          action: "#339933",
          inProgress: "#0433FF",
          complete: "#339933",
          error: "#CC3333",
          textDark: "#000000",
          textLight: "#FFFFFF"
        }
      }
    }, (error, result) => {
      const statusElement = document.getElementById('upload-status');

      if (error) {
        statusElement.textContent = `L·ªói: ${error.message || 'Kh√¥ng th·ªÉ t·∫£i ·∫£nh l√™n'}`;
        statusElement.className = 'error-message';
        console.error('Upload error:', error);
        return;
      }

      if (result && result.event === 'success') {
        statusElement.textContent = '·∫¢nh ƒë√£ t·∫£i l√™n th√†nh c√¥ng!';
        statusElement.className = 'success-message';
        document.getElementById('photo-url').value = result.info.secure_url;
        console.log("·∫¢nh ƒë√£ upload v·ªõi tags:", result.info.tags); // Ki·ªÉm tra tags
        
        // Hi·ªÉn th·ªã preview
        document.getElementById('preview').innerHTML = `
          <img src="${result.info.secure_url}" alt="·∫¢nh ƒë√£ t·∫£i l√™n">
        `;
        
        // L∆∞u URL v√†o hidden fields
        document.getElementById('photo-url').value = result.info.secure_url;
        document.getElementById('photo-html').value = 
          `<img src="${result.info.secure_url}" width="200" alt="·∫¢nh ƒë√≥ng g√≥p">`;
      }
    });

    // M·ªü widget khi click n√∫t
    document.getElementById('upload-button').addEventListener('click', () => {
      document.getElementById('upload-status').textContent = 'ƒêang chu·∫©n b·ªã t·∫£i l√™n...';
      widget.open();
    });

        document.getElementById('upload-button').addEventListener('click', () => {
      // Th√™m tr·∫°ng th√°i "ƒêang chu·∫©n b·ªã"
      const statusElement = document.getElementById('upload-status');
      statusElement.textContent = 'ƒêang m·ªü tr√¨nh t·∫£i l√™n...';
      statusElement.className = 'info-message';
      
      // M·ªü widget
      widget.open();
      
      // Ki·ªÉm tra Cloudinary c√≥ s·∫µn s√†ng kh√¥ng
      if (typeof cloudinary === 'undefined') {
        statusElement.textContent = 'L·ªói: Tr√¨nh t·∫£i l√™n ch∆∞a s·∫µn s√†ng';
        statusElement.className = 'error-message';
        return;
      }
    });

  </script>
</body>
</html>